<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¢¦å¢ƒå¼‚å˜æ¨¡æ‹Ÿå™¨ - æ­£å¤ªç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            color: #333;
            text-align: center;
            padding: 20px;
        }
        .status-item {
            margin: 20px 0;
            padding: 10px;
            border: 2px solid #333;
            border-radius: 5px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            background: #e0e0e0;
            border-radius: 5px;
            height: 20px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress {
            height: 100%;
            width: 0;
            transition: width 0.2s ease-in-out;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        /* æ–°å¢å±é™©çŠ¶æ€æ ·å¼ */
        .danger {
            background: #ffe6e6 !important;
            animation: dangerFlash 0.8s infinite;
        }
        @keyframes dangerFlash {
            50% { opacity: 0.5; }
        }
        #corruption-bar .progress {
            background: #ff6666;
        }
    </style>
</head>
<body>
    <h1>æ¢¦å¢ƒå¼‚å˜æ¨¡æ‹Ÿå™¨ - æ­£å¤ªç‰ˆ</h1>
    
    <!-- åœ¨çŠ¶æ€æ æ–°å¢æ±¡æŸ“åº¦ -->
    <div class="status-item">
        <div>ç²¾ç¥æ±¡æŸ“åº¦: <span id="corruption">0</span>%</div>
        <div class="progress-bar">
            <div class="progress" id="corruption-bar"></div>
        </div>
    </div>

    <!-- æ–°å¢å±é™©æ“ä½œæŒ‰é’® -->
    <button onclick="takeAction('occult')">ğŸ“œ è¿›è¡Œä»ªå¼</button>
    <button onclick="takeAction('artifact')">ğŸ”® æ¥è§¦å¤ç‰©</button>

<script>
let gameState = {
    stamina: 100,
    shotaProgress: 0,
    corruption: 0,
    days: 0,
    shadowMeter: 0
};

const darkEvents = [
    {
        trigger: 'occult',
        messages: [
            "ä½ å¿µå‡ºäº†ç¦å¿Œçš„å’’æ–‡ï¼Œé•œä¸­çš„å€’å½±å¼€å§‹è‡ªå·±ç§»åŠ¨...",
            "ä»ªå¼é˜µå‘å‡ºè¯¡å¼‚çº¢å…‰ï¼Œæœ‰ä»€ä¹ˆä¸œè¥¿è¿›å…¥äº†ä½ çš„æ¢¦å¢ƒ",
            "ç¥­å›ä¸Šçš„ç©å¶çªç„¶è½¬å¤´å¯¹ä½ çœ¨äº†çœ¨çœ¼"
        ],
        effect: { stamina: -40, shotaProgress: 15, corruption: 20 }
    },
    {
        trigger: 'artifact',
        messages: [
            "è§¦æ‘¸å¤ç‰©çš„ç¬é—´ï¼Œå¬åˆ°æ— æ•°å­©ç«¥çš„ç¬‘å£°...",
            "æ–‡ç‰©è¡¨é¢çš„å›¾æ¡ˆå¼€å§‹åƒè¡€ç®¡èˆ¬è„‰åŠ¨",
            "ä½ çªç„¶èƒ½å¬æ‡‚ç©å¶ä»¬çš„çªƒçªƒç§è¯­"
        ],
        effect: { stamina: -30, shotaProgress: 10, corruption: 15 }
    }
];

const corruptionEvents = [
    "æ„Ÿè§‰æœ‰å†°å‡‰çš„æ‰‹æŒ‡åˆ’è¿‡ä½ çš„åé¢ˆ...",
    "é•œä¸­çš„äººå½±æ¯”ä½ æ—©0.5ç§’åšå‡ºåŠ¨ä½œ...",
    "å¬åˆ°è€³è¯­ï¼š\"è®©å¾ç­‰è¿›å…¥...\"",
    "è¢«å­çªç„¶æ”¶ç´§åƒåœ¨æ‹¥æŠ±ä½ ...",
    "ç©å…·å…µè‡ªå·±æ’æˆäº†çŒ®ç¥­é˜µå‹...",
    "ç‰›å¥¶å°èµ·æ¥æœ‰é“é”ˆå‘³...",
    "çª—å¤–çš„æœˆäº®å˜æˆè¡€çº¢è‰²...",
    "æ‰‹æœºè‡ªåŠ¨æ’­æ”¾å¤è€çš„ç«¥è°£...",
    "æ‰€æœ‰æ¯›ç»’ç©å…·éƒ½é¢å‘ä½ è½¬å¤´...",
    "å½±å­åœ¨ç¯å…‰ä¸‹å‘ˆç°æˆå¹´å½¢æ€...",
    "ç”µå­å±å¹•æµ®ç°é™Œç”Ÿæ­£å¤ªçš„ç¬‘å®¹...",
    "é—»åˆ°æµ“çƒˆçš„æª€é¦™å‘³ï¼ˆæ˜æ˜æ²¡æœ‰é¦™ç‚‰ï¼‰..."
];

const badEndings = [
    {
        condition: (gs) => gs.corruption >= 100 && gs.shotaProgress < 50,
        message: "âš ï¸ ä½ çš„èº«ä½“è¢«å¤ç¥å æ®ï¼Œæˆä¸ºäº†æ°¸è¿œçš„äººå¶..."
    },
    {
        condition: (gs) => gs.corruption >= 100 && gs.shotaProgress >= 50,
        message: "ğŸ­ å¦ä¸€ä¸ªæ„è¯†å®Œå…¨æ¥ç®¡äº†ä½ çš„èº«ä½“..."
    },
    {
        condition: (gs) => gs.shadowMeter >= 100,
        message: "ğŸ‘» ä½ é€æ¸å˜æˆé€æ˜å­˜åœ¨ï¼Œæœ€ç»ˆæˆä¸ºé™„èº«çµ..."
    },
    {
        condition: (gs) => gs.corruption >= 80 && gs.stamina <= 20,
        message: "ğŸ§Ÿ ä½ çš„èº¯å£³è¢«å¼‚ç•Œæ­£å¤ªäº¡çµå¤ºèˆ..."
    },
    {
        condition: (gs) => gs.shotaProgress >= 80 && gs.corruption >= 70,
        message: "ğŸ©¸ è¡€è‚‰é‡æ„å¤±è´¥ï¼ŒåŒ–ä½œä¸€æ»©äººå½¢çš®ç‰©..."
    },
    {
        condition: (gs) => gs.days >= 30 && gs.shotaProgress < 100,
        message: "â³ æ—¶ç©ºå¾ªç¯ä¸­ä½ è¢«æ°¸è¿œå›°åœ¨æ­£å¤ªå½¢æ€..."
    },
    {
        condition: (gs) => Math.abs(gs.shotaProgress - gs.corruption) <= 10,
        message: "âš–ï¸ æ„è¯†åœ¨å¯¹æŠ—ä¸­æ¶ˆæ•£ï¼Œæˆä¸ºç©ºå£³å®¹å™¨..."
    }
];

// ä¿®æ”¹è¡ŒåŠ¨å¤„ç†å‡½æ•°
function takeAction(actionType) {
    if (checkGameEnd()) return;

    let eventPool = Math.random() < 0.5 ? 
        [...darkEvents] : [];

    let event = getRandomEvent(actionType, eventPool);
    
    ['stamina', 'shotaProgress', 'corruption'].forEach(stat => {
        gameState[stat] = Math.max(0, Math.min(100, 
            gameState[stat] + (event.effect[stat] || 0)));
    });

    gameState.shadowMeter += Math.floor(
        (gameState.corruption * 0.7) + (gameState.shotaProgress * 0.3)
    ) % 100;

    addEventMessage(event.messages[Math.floor(Math.random() * event.messages.length)]);
    
    if (Math.random() < 0.3) {
        addEventMessage(
            corruptionEvents[Math.floor(Math.random() * corruptionEvents.length)]
        );
        gameState.corruption += 5;
    }

    updateDisplay();
    checkGameEnd();
}

// è·å–éšæœºäº‹ä»¶
function getRandomEvent(actionType, eventPool) {
    return eventPool.find(event => event.trigger === actionType) || { effect: {} };
}

// æ·»åŠ äº‹ä»¶æ¶ˆæ¯
function addEventMessage(message) {
    alert(message); // ä½¿ç”¨å¼¹çª—å±•ç¤ºä¿¡æ¯
}

// å¢å¼ºæ¸¸æˆç»“æŸæ£€æŸ¥
function checkGameEnd() {
    if (gameState.shotaProgress >= 100) {
        alert('ğŸ‰ æˆåŠŸï¼ä½†ä¼¼ä¹æœ‰ä»€ä¹ˆåˆ«çš„ä¸œè¥¿ä¹Ÿä¸€èµ·é†’æ¥äº†...');
        resetGame();
        return true;
    }
    if (gameState.stamina <= 0) {
        alert('ğŸ’€ åœ¨å½»åº•è™šè„±ä¸­ï¼Œä½ æ„Ÿå—åˆ°æŸç§å­˜åœ¨æ¥ç®¡äº†èº«ä½“...');
        resetGame();
        return true;
    }

    const triggeredEnding = badEndings.find(end => end.condition(gameState));
    if (triggeredEnding) {
        alert(`ğŸ’” åç»“å±€ï¼š${triggeredEnding.message}`);
        resetGame();
        return true;
    }
    return false;
}

function resetGame() {
    gameState = {
        stamina: 100,
        shotaProgress: 0,
        corruption: 0,
        days: 0,
        shadowMeter: 0
    };
    updateDisplay();
}

// æ›´æ–°æ˜¾ç¤ºå‡½æ•°
function updateDisplay() {
    document.getElementById('corruption').textContent = gameState.corruption;
    document.getElementById('corruption-bar').style.width = `${gameState.corruption}%`;
    
    document.getElementById('corruption-bar').parentElement.classList.toggle(
        'danger', gameState.corruption >= 50
    );
}
</script>
</body>
</html>
